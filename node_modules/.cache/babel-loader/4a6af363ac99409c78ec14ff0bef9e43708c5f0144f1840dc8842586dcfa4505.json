{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import api from'../utils/api';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{let isMounted=true;// Check if we're on an admin route\nconst isAdminRoute=window.location.pathname.startsWith('/admin');if(isAdminRoute){// For admin routes, use sessionStorage instead of localStorage\n// This ensures credentials are cleared when browser tab is closed\n// Check sessionStorage for token (not localStorage)\nconst token=sessionStorage.getItem('adminToken');const savedUser=sessionStorage.getItem('adminUser');if(token&&savedUser){try{const user=JSON.parse(savedUser);setUser(user);// Set token in axios defaults for API calls\napi.defaults.headers.common['Authorization']=\"Bearer \".concat(token);}catch(e){sessionStorage.removeItem('adminToken');sessionStorage.removeItem('adminUser');if(isMounted){setUser(null);setLoading(false);}return;}// Verify token is still valid\napi.get('/auth/me').then(res=>{if(isMounted){setUser(res.data);}}).catch(error=>{var _error$response;if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){sessionStorage.removeItem('adminToken');sessionStorage.removeItem('adminUser');}if(isMounted){setUser(null);}}).finally(()=>{if(isMounted){setLoading(false);}});}else{// No session - require login\n// Clear any old localStorage tokens\nlocalStorage.removeItem('token');localStorage.removeItem('user');if(isMounted){setUser(null);setLoading(false);}}}else{// Non-admin routes - no auto-restore needed\nif(isMounted){setUser(null);setLoading(false);}}return()=>{isMounted=false;};},[]);const login=async(email,password)=>{try{const res=await api.post('/auth/login',{email,password});if(res.data.mustChangePassword){return{mustChangePassword:true,userId:res.data.userId};}// Use sessionStorage for admin sessions (clears when tab closes)\nsessionStorage.setItem('adminToken',res.data.token);sessionStorage.setItem('adminUser',JSON.stringify(res.data.user));// Also clear localStorage to ensure no persistence\nlocalStorage.removeItem('token');localStorage.removeItem('user');// Set token in axios defaults\napi.defaults.headers.common['Authorization']=\"Bearer \".concat(res.data.token);setUser(res.data.user);return{success:true,user:res.data.user};}catch(error){var _error$response2;throw((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data)||{error:'Login failed'};}};const changePassword=async(userId,currentPassword,newPassword)=>{try{const res=await api.post('/auth/change-password',{userId,currentPassword,newPassword});// Use sessionStorage for admin sessions\nsessionStorage.setItem('adminToken',res.data.token);sessionStorage.setItem('adminUser',JSON.stringify(res.data.user));// Clear localStorage\nlocalStorage.removeItem('token');localStorage.removeItem('user');// Set token in axios defaults\napi.defaults.headers.common['Authorization']=\"Bearer \".concat(res.data.token);setUser(res.data.user);return{success:true,user:res.data.user};}catch(error){var _error$response3;throw((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.data)||{error:'Password change failed'};}};const logout=()=>{// Clear all authentication data (both sessionStorage and localStorage)\nsessionStorage.removeItem('adminToken');sessionStorage.removeItem('adminUser');localStorage.removeItem('token');localStorage.removeItem('user');delete api.defaults.headers.common['Authorization'];setUser(null);// Force redirect to login page\nwindow.location.href='/admin/login';};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,login,logout,changePassword,loading},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","isMounted","isAdminRoute","window","location","pathname","startsWith","token","sessionStorage","getItem","savedUser","JSON","parse","defaults","headers","common","concat","e","removeItem","get","then","res","data","catch","error","_error$response","response","status","finally","localStorage","login","email","password","post","mustChangePassword","userId","setItem","stringify","success","_error$response2","changePassword","currentPassword","newPassword","_error$response3","logout","href","Provider","value"],"sources":["C:/Users/Liyandah/Desktop/reshow/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\nimport api from '../utils/api';\n\nexport const AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    let isMounted = true;\n    \n    // Check if we're on an admin route\n    const isAdminRoute = window.location.pathname.startsWith('/admin');\n    \n    if (isAdminRoute) {\n      // For admin routes, use sessionStorage instead of localStorage\n      // This ensures credentials are cleared when browser tab is closed\n      // Check sessionStorage for token (not localStorage)\n      const token = sessionStorage.getItem('adminToken');\n      const savedUser = sessionStorage.getItem('adminUser');\n\n      if (token && savedUser) {\n        try {\n          const user = JSON.parse(savedUser);\n          setUser(user);\n          // Set token in axios defaults for API calls\n          api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        } catch (e) {\n          sessionStorage.removeItem('adminToken');\n          sessionStorage.removeItem('adminUser');\n          if (isMounted) {\n            setUser(null);\n            setLoading(false);\n          }\n          return;\n        }\n        \n        // Verify token is still valid\n        api.get('/auth/me')\n          .then(res => {\n            if (isMounted) {\n              setUser(res.data);\n            }\n          })\n          .catch((error) => {\n            if (error.response?.status === 401) {\n              sessionStorage.removeItem('adminToken');\n              sessionStorage.removeItem('adminUser');\n            }\n            if (isMounted) {\n              setUser(null);\n            }\n          })\n          .finally(() => {\n            if (isMounted) {\n              setLoading(false);\n            }\n          });\n      } else {\n        // No session - require login\n        // Clear any old localStorage tokens\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        if (isMounted) {\n          setUser(null);\n          setLoading(false);\n        }\n      }\n    } else {\n      // Non-admin routes - no auto-restore needed\n      if (isMounted) {\n        setUser(null);\n        setLoading(false);\n      }\n    }\n    \n    return () => {\n      isMounted = false;\n    };\n  }, []);\n\n  const login = async (email, password) => {\n    try {\n      const res = await api.post('/auth/login', { email, password });\n      \n      if (res.data.mustChangePassword) {\n        return { mustChangePassword: true, userId: res.data.userId };\n      }\n\n      // Use sessionStorage for admin sessions (clears when tab closes)\n      sessionStorage.setItem('adminToken', res.data.token);\n      sessionStorage.setItem('adminUser', JSON.stringify(res.data.user));\n      // Also clear localStorage to ensure no persistence\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      // Set token in axios defaults\n      api.defaults.headers.common['Authorization'] = `Bearer ${res.data.token}`;\n      setUser(res.data.user);\n      return { success: true, user: res.data.user };\n    } catch (error) {\n      throw error.response?.data || { error: 'Login failed' };\n    }\n  };\n\n  const changePassword = async (userId, currentPassword, newPassword) => {\n    try {\n      const res = await api.post('/auth/change-password', {\n        userId,\n        currentPassword,\n        newPassword\n      });\n\n      // Use sessionStorage for admin sessions\n      sessionStorage.setItem('adminToken', res.data.token);\n      sessionStorage.setItem('adminUser', JSON.stringify(res.data.user));\n      // Clear localStorage\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      // Set token in axios defaults\n      api.defaults.headers.common['Authorization'] = `Bearer ${res.data.token}`;\n      setUser(res.data.user);\n      return { success: true, user: res.data.user };\n    } catch (error) {\n      throw error.response?.data || { error: 'Password change failed' };\n    }\n  };\n\n  const logout = () => {\n    // Clear all authentication data (both sessionStorage and localStorage)\n    sessionStorage.removeItem('adminToken');\n    sessionStorage.removeItem('adminUser');\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    delete api.defaults.headers.common['Authorization'];\n    setUser(null);\n    // Force redirect to login page\n    window.location.href = '/admin/login';\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, login, logout, changePassword, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}