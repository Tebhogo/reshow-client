{"ast":null,"code":"import axios from'axios';// Get API URL from environment variable or use default\nlet API_URL=process.env.REACT_APP_API_URL;// If not set or empty, use default\nif(!API_URL||API_URL.trim()===''){// Try to detect server port, default to 3000 but fallback to 5000\nAPI_URL='http://localhost:3000/api';}else{// Clean up the URL\nAPI_URL=API_URL.trim();// Fix common issues\nif(API_URL.startsWith(':')){// If it starts with :, add localhost\nAPI_URL=\"http://localhost\".concat(API_URL);}else if(!API_URL.startsWith('http://')&&!API_URL.startsWith('https://')){// If no protocol, add http://\nif(API_URL.startsWith('//')){API_URL=\"http:\".concat(API_URL);}else{API_URL=\"http://\".concat(API_URL);}}// Ensure it ends with /api\nif(!API_URL.endsWith('/api')){API_URL=API_URL.replace(/\\/?$/,'')+'/api';}}// Debug log to help troubleshoot\nif(process.env.NODE_ENV==='development'){console.log('API Base URL configured as:',API_URL);}const api=axios.create({baseURL:API_URL,headers:{'Content-Type':'application/json'},timeout:10000// 10 second timeout\n});// Add token to requests\napi.interceptors.request.use(config=>{// Check sessionStorage first for admin tokens, then localStorage as fallback\nconst token=sessionStorage.getItem('adminToken')||localStorage.getItem('token');if(token){config.headers.Authorization=\"Bearer \".concat(token);}// If sending FormData, remove Content-Type header so axios can set it with boundary\nif(config.data instanceof FormData){delete config.headers['Content-Type'];}return config;},error=>{return Promise.reject(error);});// Handle token expiration\napi.interceptors.response.use(response=>response,error=>{var _error$response;// Only redirect to login if:\n// 1. It's a 401 error (unauthorized)\n// 2. User is on an admin page (to avoid redirect loops on public pages)\n// 3. Not already on the login page\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){const currentPath=window.location.pathname;const isAdminPage=currentPath.startsWith('/admin');const isLoginPage=currentPath==='/admin/login';// Only redirect if on admin page and not already on login page\nif(isAdminPage&&!isLoginPage){sessionStorage.removeItem('adminToken');sessionStorage.removeItem('adminUser');localStorage.removeItem('token');localStorage.removeItem('user');window.location.href='/admin/login';}else{// For public pages, just clear the token silently\nsessionStorage.removeItem('adminToken');sessionStorage.removeItem('adminUser');localStorage.removeItem('token');localStorage.removeItem('user');}}return Promise.reject(error);});// Helper function to construct full image URL from relative path\nexport const getImageUrl=imagePath=>{if(!imagePath)return'/images/placeholder.jpg';// If already a full URL, return as is\nif(imagePath.startsWith('http://')||imagePath.startsWith('https://')){return imagePath;}// If it's a static image path, return as is\nif(imagePath.startsWith('/images')){return imagePath;}// If it's an uploaded image (/uploads), construct full URL\nif(imagePath.startsWith('/uploads')){const apiBaseUrl=api.defaults.baseURL||'http://localhost:3000/api';const serverBaseUrl=apiBaseUrl.replace('/api','');return\"\".concat(serverBaseUrl).concat(imagePath);}// For any other relative path, also construct full URL\nconst apiBaseUrl=api.defaults.baseURL||'http://localhost:3000/api';const serverBaseUrl=apiBaseUrl.replace('/api','');return\"\".concat(serverBaseUrl).concat(imagePath);};export default api;","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","trim","startsWith","concat","endsWith","replace","NODE_ENV","console","log","api","create","baseURL","headers","timeout","interceptors","request","use","config","token","sessionStorage","getItem","localStorage","Authorization","data","FormData","error","Promise","reject","response","_error$response","status","currentPath","window","location","pathname","isAdminPage","isLoginPage","removeItem","href","getImageUrl","imagePath","apiBaseUrl","defaults","serverBaseUrl"],"sources":["C:/Users/Liyandah/Desktop/reshow/client/src/utils/api.js"],"sourcesContent":["import axios from 'axios';\n\n// Get API URL from environment variable or use default\nlet API_URL = process.env.REACT_APP_API_URL;\n\n// If not set or empty, use default\nif (!API_URL || API_URL.trim() === '') {\n  // Try to detect server port, default to 3000 but fallback to 5000\n  API_URL = 'http://localhost:3000/api';\n} else {\n  // Clean up the URL\n  API_URL = API_URL.trim();\n  \n  // Fix common issues\n  if (API_URL.startsWith(':')) {\n    // If it starts with :, add localhost\n    API_URL = `http://localhost${API_URL}`;\n  } else if (!API_URL.startsWith('http://') && !API_URL.startsWith('https://')) {\n    // If no protocol, add http://\n    if (API_URL.startsWith('//')) {\n      API_URL = `http:${API_URL}`;\n    } else {\n      API_URL = `http://${API_URL}`;\n    }\n  }\n  \n  // Ensure it ends with /api\n  if (!API_URL.endsWith('/api')) {\n    API_URL = API_URL.replace(/\\/?$/, '') + '/api';\n  }\n}\n\n// Debug log to help troubleshoot\nif (process.env.NODE_ENV === 'development') {\n  console.log('API Base URL configured as:', API_URL);\n}\n\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  timeout: 10000, // 10 second timeout\n});\n\n// Add token to requests\napi.interceptors.request.use(\n  (config) => {\n    // Check sessionStorage first for admin tokens, then localStorage as fallback\n    const token = sessionStorage.getItem('adminToken') || localStorage.getItem('token');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    \n    // If sending FormData, remove Content-Type header so axios can set it with boundary\n    if (config.data instanceof FormData) {\n      delete config.headers['Content-Type'];\n    }\n    \n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Handle token expiration\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    // Only redirect to login if:\n    // 1. It's a 401 error (unauthorized)\n    // 2. User is on an admin page (to avoid redirect loops on public pages)\n    // 3. Not already on the login page\n    if (error.response?.status === 401) {\n      const currentPath = window.location.pathname;\n      const isAdminPage = currentPath.startsWith('/admin');\n      const isLoginPage = currentPath === '/admin/login';\n      \n      // Only redirect if on admin page and not already on login page\n      if (isAdminPage && !isLoginPage) {\n        sessionStorage.removeItem('adminToken');\n        sessionStorage.removeItem('adminUser');\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        window.location.href = '/admin/login';\n      } else {\n        // For public pages, just clear the token silently\n        sessionStorage.removeItem('adminToken');\n        sessionStorage.removeItem('adminUser');\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\n// Helper function to construct full image URL from relative path\nexport const getImageUrl = (imagePath) => {\n  if (!imagePath) return '/images/placeholder.jpg';\n  \n  // If already a full URL, return as is\n  if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {\n    return imagePath;\n  }\n  \n  // If it's a static image path, return as is\n  if (imagePath.startsWith('/images')) {\n    return imagePath;\n  }\n  \n  // If it's an uploaded image (/uploads), construct full URL\n  if (imagePath.startsWith('/uploads')) {\n    const apiBaseUrl = api.defaults.baseURL || 'http://localhost:3000/api';\n    const serverBaseUrl = apiBaseUrl.replace('/api', '');\n    return `${serverBaseUrl}${imagePath}`;\n  }\n  \n  // For any other relative path, also construct full URL\n  const apiBaseUrl = api.defaults.baseURL || 'http://localhost:3000/api';\n  const serverBaseUrl = apiBaseUrl.replace('/api', '');\n  return `${serverBaseUrl}${imagePath}`;\n};\n\nexport default api;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}